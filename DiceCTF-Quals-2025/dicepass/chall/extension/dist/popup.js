/*! For license information please see popup.js.LICENSE.txt */
var __webpack_modules__={484:function(e,t,n){!function(e,t){"use strict";const n="__COMLINK_MESSAGE_CHANNEL__",r="__COMLINK_MESSAGE_PORT_MARKER__",s="message",a="Only message event is supported",o="__PROXY_MESSAGE_CHANNEL_MARKER__",i=e=>"object"==typeof e&&null!==e||"function"==typeof e,l=()=>new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-"),c=(e,t)=>t.length&&e?(null==e?void 0:e.value)===r?(e.value=t[0],e):"object"==typeof e?JSON.parse(JSON.stringify(e),((e,n)=>n&&n===r?t[0]:n)):e:e,d=new Map,p=e=>{d.has("proxy")||d.set("proxy",(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){if(e){const{port1:s,port2:a}=new e;return t.expose(n,g(s,e)),[r,[a]]}const{port1:s,port2:a}=new MessageChannel;return t.expose(n,s),[r,[a]]},deserialize(n){n.start();const r=n instanceof MessagePort?n:g(n,e);return t.wrap(r)}}))(e)),d.has("messagePort")||d.set("messagePort",(e=>({canHandle:e=>!!(e&&"object"==typeof e&&Reflect.get(e,"start")&&Reflect.get(e,"postMessage")),serialize(t){if(e){const{port1:n,port2:s}=new e;return u(t,n),[r,[s]]}return[r,[t]]},deserialize:e=>(e.start(),e)}))(e)),t.transferHandlers.set("messagePort",d.get("messagePort")),t.transferHandlers.set("proxy",d.get("proxy"))},u=(e,t)=>{e.addEventListener("message",(e=>{t.postMessage(e.data,[])})),e.addEventListener("close",(()=>{t.close()})),t.addListener("message",(t=>{e.postMessage(t.data,[])})),t.addListener("close",(()=>{e.close()})),e.start(),t.start()};function g(e,t){p(t);const n=new WeakMap;return{start:()=>e.start(),postMessage:(t,n)=>{e.postMessage(t,n||[])},addEventListener:(t,r)=>{if(t!==s)throw new Error(a);const o=e=>{const t=c(e.data,e.ports);"handleEvent"in r?r.handleEvent({data:t,ports:e.ports}):r({data:t,ports:e.ports})};e.addListener(s,o),n.set(r,o)},removeEventListener:(t,r)=>{if(t!==s)throw new Error(a);const o=n.get(r);o&&(e.removeListener(s,o),n.delete(r))}}}const f={canHandle:e=>i(e)&&e[t.proxyMarker],serialize:()=>[null,[]],deserialize:()=>function(){throw new Error("Operation not supported")}};const m={canHandle:e=>i(e)&&e[t.proxyMarker],serialize:()=>[null,[]],deserialize:()=>function(){throw new Error("Operation not supported")}};const E=new Map,h=e=>{E.has(e)||(E.set(e,(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){const r=l();return t.expose(n,w({socket:e,messageChannel:r})),[{[o]:r},[]]},deserialize:n=>t.wrap(w({socket:e,messageChannel:Reflect.get(n,o)}))}))(e)),e.on("disconnect",(()=>{E.has(e)&&E.delete(e)}))),t.transferHandlers.set("proxy",E.get(e))};function w(e){const t=new WeakMap,{socket:r,messageChannel:o=n}=e;return h(r),{postMessage:(e,t)=>{r.emit(o,e)},addEventListener:(e,n)=>{if(e!==s)throw new Error(a);const i=e=>{"handleEvent"in n?n.handleEvent({data:e,ports:[]}):n({data:e,ports:[]})};r.on(o,i),t.set(n,i)},removeEventListener:(e,n)=>{if(e!==s)throw new Error(a);const i=t.get(n);i&&(r.off(o,i),t.delete(n))}}}const _=new Map,v=e=>{if(!_.has(e)){_.set(e,(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){const r=l();return t.expose(n,y({webSocket:e,messageChannel:r})),[{[o]:r},[]]},deserialize:n=>t.wrap(y({webSocket:e,messageChannel:Reflect.get(n,o)}))}))(e));const n=()=>{_.has(e)&&_.delete(e)};e.addEventListener("close",n)}t.transferHandlers.set("proxy",_.get(e))};function y(e){const{webSocket:t,messageChannel:r}=e,s=t,a=new WeakMap,o=r||n;return v(s),{postMessage:(e,t)=>{s.send(JSON.stringify({message:e,__channel__:o}))},addEventListener:(e,t)=>{const n=e=>{let n=null;try{n=JSON.parse(e.data)}catch{n=e.data}!n||!n.__channel__||!n.message||n.__channel__!==o||("handleEvent"in t?t.handleEvent({data:n.message}):t({data:n.message}))};s.addEventListener("message",n),a.set(t,n)},removeEventListener:(e,t)=>{const n=a.get(t);n&&(s.removeEventListener("message",n),a.delete(t))},start:()=>{}}}const M=new Map,b=e=>{if(!M.has(e)){M.set(e,(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){const r=l();return t.expose(n,L({nodeProcess:e,messageChannel:r})),[{[o]:r},[]]},deserialize:n=>t.wrap(L({nodeProcess:e,messageChannel:Reflect.get(n,o)}))}))(e));const n=()=>{M.has(e)&&M.delete(e)};process.on("exit",n),process.on("disconnect",n),process.on("SIGINT",n),process.on("uncaughtException",n)}t.transferHandlers.set("proxy",M.get(e))};function L(e){const{nodeProcess:t,messageChannel:r}=e,s=new WeakMap,a=r||n;return b(t),{postMessage:(e,n)=>{t.send&&t.send({message:e,__channel__:a})},addEventListener:(e,n)=>{const r=e=>{if(!e||!e.__channel__||!e.message||e.__channel__!==a)return;const{message:t}=e;"handleEvent"in n?n.handleEvent({data:t}):n({data:t})};t.on("message",r),s.set(n,r)},removeEventListener:(e,n)=>{const r=s.get(n);r&&(t.off("message",r),s.delete(n))},start:()=>{}}}e.MESSAGE_CHANNEL_NAME=n,e.MESSAGE_EVENT_ERROR=a,e.MESSAGE_EVENT_NAME=s,e.MESSAGE_PORT_MARKER=r,e.PROXY_MESSAGE_CHANNEL_MARKER=o,e.chromeRuntimeMessageEndpoint=function(e){const{tabId:n=0,extensionId:r=""}=e||{};t.transferHandlers.set("proxy",m);const o=new Set,i=(e,t,n)=>{if(e&&o.size)for(const t of o.values())"handleEvent"in t?t.handleEvent({data:e,ports:[]}):t({data:e,ports:[]})};return r?chrome.runtime.onMessageExternal.addListener(i):chrome.runtime.onMessage.addListener(i),{start:()=>{},postMessage:(e,t)=>{n?chrome.tabs.sendMessage(n,e):r?chrome.runtime.sendMessage(r,e):chrome.runtime.sendMessage(e)},addEventListener:(e,t)=>{if(e!==s)throw new Error(a);o.add(t)},removeEventListener:(e,t)=>{if(e!==s)throw new Error(a);o.has(t)&&o.delete(t)}}},e.chromeRuntimePortEndpoint=function(e){t.transferHandlers.set("proxy",m);const n=new WeakMap;return{start:()=>{},postMessage:(t,n)=>{e.postMessage(t)},addEventListener:(t,r)=>{if(t!==s)throw new Error(a);const o=(e,t)=>{"handleEvent"in r?r.handleEvent({data:e,ports:[]}):r({data:e,ports:[]})};e.onMessage.addListener(o),n.set(r,o)},removeEventListener:(e,t)=>{if(e!==s)throw new Error(a);n.get(t)&&n.delete(t)}}},e.electronMainEndpoint=function(e){const{sender:t,ipcMain:r,messageChannelConstructor:o,channelName:i=n}=e;p(o);const l=new WeakMap;return{postMessage:(e,n)=>{t.postMessage(i,e,n)},addEventListener:(e,t)=>{if(e!==s)throw new Error(a);const n=(e,...n)=>{const{ports:r}=e,s=c(n[0],r);"handleEvent"in t?t.handleEvent({data:s,ports:r}):t({data:s,ports:r})};r.on(i,n),l.set(t,n)},removeEventListener:(e,t)=>{if(e!==s)throw new Error(a);const n=l.get(t);n&&(r.removeListener(i,n),l.delete(t))}}},e.electronMessagePortMainEndpoint=g,e.electronRendererEndpoint=function(e){p();const t=new WeakMap,{ipcRenderer:r,channelName:o=n}=e;return{postMessage:(e,t)=>{r.postMessage(o,e,t)},addEventListener:(e,n)=>{if(e!==s)throw new Error(a);const i=(e,...t)=>{const{ports:r}=e,s=c(t[0],r);"handleEvent"in n?n.handleEvent({data:s,ports:r}):n({data:s,ports:r})};r.on(o,i),t.set(n,i)},removeEventListener:(e,n)=>{if(e!==s)throw new Error(a);const i=t.get(n);i&&(r.removeListener(o,i),t.delete(n))}}},e.figmaCoreEndpoint=function(e){t.transferHandlers.set("proxy",f);const n=new WeakMap;return{postMessage:(t,n)=>{figma.ui.postMessage(t,{origin:(null==e?void 0:e.origin)||"*"})},addEventListener:(t,r)=>{if(t!==s)throw new Error(a);const o=async(t,n)=>{(null==e||!e.checkProps||await(null==e?void 0:e.checkProps(n)))&&("handleEvent"in r?r.handleEvent({data:t,ports:[]}):r({data:t,ports:[]}))};figma.ui.on(s,o),n.set(r,o)},removeEventListener:(e,t)=>{if(e!==s)throw new Error(a);const r=n.get(t);r&&(figma.ui.off(s,r),n.delete(t))}}},e.figmaUIEndpoint=function(e){t.transferHandlers.set("proxy",f);const n=new WeakMap;return{postMessage:(t,n)=>{globalThis.parent.postMessage({pluginMessage:t},{targetOrigin:(null==e?void 0:e.origin)||"*",transfer:n})},addEventListener:(e,t)=>{if(e!==s)throw new Error(a);const r=e=>{const{ports:n,data:r}=e;"handleEvent"in t?t.handleEvent({data:r.pluginMessage,ports:n}):t({data:r.pluginMessage,ports:n})};globalThis.addEventListener(s,r),n.set(t,r)},removeEventListener:(e,t)=>{if(e!==s)throw new Error(a);const r=n.get(t);r&&(globalThis.removeEventListener(s,r),n.delete(t))}}},e.nodeProcessEndpoint=L,e.socketIoEndpoint=w,e.webSocketEndpoint=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}(t,n(590))},590:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createEndpoint:()=>s,expose:()=>d,finalizer:()=>o,proxy:()=>y,proxyMarker:()=>r,releaseProxy:()=>a,transfer:()=>v,transferHandlers:()=>c,windowEndpoint:()=>M,wrap:()=>u});const r=Symbol("Comlink.proxy"),s=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.finalizer"),i=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=new Map([["proxy",{canHandle:e=>l(e)&&e[r],serialize(e){const{port1:t,port2:n}=new MessageChannel;return d(e,t),[n,[n]]},deserialize:e=>(e.start(),u(e))}],["throw",{canHandle:e=>l(e)&&i in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function d(e,t=globalThis,n=["*"]){t.addEventListener("message",(function r(s){if(!s||!s.data)return;if(!function(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,s.origin))return void console.warn(`Invalid origin '${s.origin}' for comlink proxy`);const{id:a,type:l,path:c}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(L);let g;try{const t=c.slice(0,-1).reduce(((e,t)=>e[t]),e),n=c.reduce(((e,t)=>e[t]),e);switch(l){case"GET":g=n;break;case"SET":t[c.slice(-1)[0]]=L(s.data.value),g=!0;break;case"APPLY":g=n.apply(t,u);break;case"CONSTRUCT":g=y(new n(...u));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;d(e,n),g=v(t,[t])}break;case"RELEASE":g=void 0;break;default:return}}catch(e){g={value:e,[i]:0}}Promise.resolve(g).catch((e=>({value:e,[i]:0}))).then((n=>{const[s,i]=b(n);t.postMessage(Object.assign(Object.assign({},s),{id:a}),i),"RELEASE"===l&&(t.removeEventListener("message",r),p(t),o in e&&"function"==typeof e[o]&&e[o]())})).catch((e=>{const[n,r]=b({value:new TypeError("Unserializable return value"),[i]:0});t.postMessage(Object.assign(Object.assign({},n),{id:a}),r)}))})),t.start&&t.start()}function p(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function u(e,t){const n=new Map;return e.addEventListener("message",(function(e){const{data:t}=e;if(!t||!t.id)return;const r=n.get(t.id);if(r)try{r(t)}finally{n.delete(t.id)}})),h(e,n,[],t)}function g(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e){return k(e,new Map,{type:"RELEASE"}).then((()=>{p(e)}))}const m=new WeakMap,E="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(m.get(e)||0)-1;m.set(e,t),0===t&&f(e)}));function h(e,t,n=[],r=function(){}){let o=!1;const i=new Proxy(r,{get(r,s){if(g(o),s===a)return()=>{!function(e){E&&E.unregister(e)}(i),f(e),t.clear(),o=!0};if("then"===s){if(0===n.length)return{then:()=>i};const r=k(e,t,{type:"GET",path:n.map((e=>e.toString()))}).then(L);return r.then.bind(r)}return h(e,t,[...n,s])},set(r,s,a){g(o);const[i,l]=b(a);return k(e,t,{type:"SET",path:[...n,s].map((e=>e.toString())),value:i},l).then(L)},apply(r,a,i){g(o);const l=n[n.length-1];if(l===s)return k(e,t,{type:"ENDPOINT"}).then(L);if("bind"===l)return h(e,t,n.slice(0,-1));const[c,d]=w(i);return k(e,t,{type:"APPLY",path:n.map((e=>e.toString())),argumentList:c},d).then(L)},construct(r,s){g(o);const[a,i]=w(s);return k(e,t,{type:"CONSTRUCT",path:n.map((e=>e.toString())),argumentList:a},i).then(L)}});return function(e,t){const n=(m.get(t)||0)+1;m.set(t,n),E&&E.register(e,t,e)}(i,e),i}function w(e){const t=e.map(b);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const _=new WeakMap;function v(e,t){return _.set(e,t),e}function y(e){return Object.assign(e,{[r]:!0})}function M(e,t=globalThis,n="*"){return{postMessage:(t,r)=>e.postMessage(t,n,r),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function b(e){for(const[t,n]of c)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},s]}return[{type:"RAW",value:e},_.get(e)||[]]}function L(e){switch(e.type){case"HANDLER":return c.get(e.name).deserialize(e.value);case"RAW":return e.value}}function k(e,t,n,r){return new Promise((s=>{const a=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.set(a,s),e.start&&e.start(),e.postMessage(Object.assign({id:a},n),r)}))}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};const Comlink=__webpack_require__(590),{chromeRuntimeMessageEndpoint}=__webpack_require__(484);console.log("[dicepass] Hello from dicepass popup");const $=document.querySelector.bind(document);window.addEventListener("load",(async()=>{console.log("[dicepass] popup loaded"),await Promise.race([chrome.runtime.sendMessage("init-popup"),new Promise((e=>setTimeout(e,200)))]);const e=Comlink.wrap(chromeRuntimeMessageEndpoint());if(!await e.initialized())return $("#container").style.display="flex",$("#subtitle").innerText="Enter a master password to get started",$("#register-form").style.display="block",void $("#register-form").addEventListener("submit",(async t=>{t.preventDefault();const n=$('#register-form input[type="password"]').value;n&&(await e.initialize(n)?location.reload():alert("Failed to initialize"))}));if(!await e.isLoggedIn())return $("#container").style.display="flex",$("#subtitle").innerText="Enter your master password to log in",$("#login-form").style.display="block",void $("#login-form").addEventListener("submit",(async t=>{t.preventDefault();const n=$('#login-form input[type="password"]').value;n&&(await e.login(n)?location.reload():(alert("Invalid password"),$('#login-form input[type="password"]').value=""))}));$("#container").style.display="flex",$("#subtitle").innerText="Welcome to dicepass",$("#auth-view").style.display="block",$("#logout").addEventListener("click",(async()=>{await e.logout(),location.reload()})),$("#clear").addEventListener("click",(async()=>{confirm("Are you sure you want to clear all data?")&&(await e.clear(),location.reload())})),$("#new-form").addEventListener("submit",(async t=>{t.preventDefault();const n=$('#new-form input[type="url"]').value,r=$('#new-form input[type="text"]').value,s=$('#new-form input[type="password"]').value;if(!n||!r||!s)return;const a=new URL(n).origin;await e.add(a,r,s),location.reload()}));const t=await e.vault();if(0===t.length)return void($("#vault").innerText="No passwords saved");const n=document.createElement("table"),r=[["","Domain","Username","Password"]];for(const{origin:e,username:n}of t)r.push(["🗑️",e,n,""]);for(let t=0;t<r.length;t++){const s=r[t],a=document.createElement("tr");for(let n=0;n<s.length;n++){const r=document.createElement(0===t?"th":"td");if(0!==t){if(0===n){const t=document.createElement("a");t.innerText=s[n],t.href="#",t.addEventListener("click",(async()=>{confirm("Are you sure you want to delete this password?")&&(await e.remove(s[1]),location.reload())})),r.appendChild(t)}else if(3===n){const t=document.createElement("a");t.innerText="********",t.href="#",t.addEventListener("click",(async()=>{const t=prompt("Please re-enter your master password:");if(!t)return;const n=await e.reveal(s[1],t);n.error?alert(n.error):prompt("Your password for "+s[1]+" is: ",n.password)})),r.appendChild(t)}else r.innerText=s[n];a.appendChild(r)}else r.innerText=s[n],a.appendChild(r)}n.appendChild(a)}$("#vault").appendChild(n)}));