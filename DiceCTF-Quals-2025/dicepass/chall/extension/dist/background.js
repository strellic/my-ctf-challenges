/*! For license information please see background.js.LICENSE.txt */
var __webpack_modules__={484:function(e,t,n){!function(e,t){"use strict";const n="__COMLINK_MESSAGE_CHANNEL__",r="__COMLINK_MESSAGE_PORT_MARKER__",a="message",s="Only message event is supported",o="__PROXY_MESSAGE_CHANNEL_MARKER__",i=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=()=>new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-"),l=(e,t)=>t.length&&e?(null==e?void 0:e.value)===r?(e.value=t[0],e):"object"==typeof e?JSON.parse(JSON.stringify(e),((e,n)=>n&&n===r?t[0]:n)):e:e,p=new Map,d=e=>{p.has("proxy")||p.set("proxy",(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){if(e){const{port1:a,port2:s}=new e;return t.expose(n,g(a,e)),[r,[s]]}const{port1:a,port2:s}=new MessageChannel;return t.expose(n,a),[r,[s]]},deserialize(n){n.start();const r=n instanceof MessagePort?n:g(n,e);return t.wrap(r)}}))(e)),p.has("messagePort")||p.set("messagePort",(e=>({canHandle:e=>!!(e&&"object"==typeof e&&Reflect.get(e,"start")&&Reflect.get(e,"postMessage")),serialize(t){if(e){const{port1:n,port2:a}=new e;return u(t,n),[r,[a]]}return[r,[t]]},deserialize:e=>(e.start(),e)}))(e)),t.transferHandlers.set("messagePort",p.get("messagePort")),t.transferHandlers.set("proxy",p.get("proxy"))},u=(e,t)=>{e.addEventListener("message",(e=>{t.postMessage(e.data,[])})),e.addEventListener("close",(()=>{t.close()})),t.addListener("message",(t=>{e.postMessage(t.data,[])})),t.addListener("close",(()=>{e.close()})),e.start(),t.start()};function g(e,t){d(t);const n=new WeakMap;return{start:()=>e.start(),postMessage:(t,n)=>{e.postMessage(t,n||[])},addEventListener:(t,r)=>{if(t!==a)throw new Error(s);const o=e=>{const t=l(e.data,e.ports);"handleEvent"in r?r.handleEvent({data:t,ports:e.ports}):r({data:t,ports:e.ports})};e.addListener(a,o),n.set(r,o)},removeEventListener:(t,r)=>{if(t!==a)throw new Error(s);const o=n.get(r);o&&(e.removeListener(a,o),n.delete(r))}}}const y={canHandle:e=>i(e)&&e[t.proxyMarker],serialize:()=>[null,[]],deserialize:()=>function(){throw new Error("Operation not supported")}};const m={canHandle:e=>i(e)&&e[t.proxyMarker],serialize:()=>[null,[]],deserialize:()=>function(){throw new Error("Operation not supported")}};const h=new Map,f=e=>{h.has(e)||(h.set(e,(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){const r=c();return t.expose(n,w({socket:e,messageChannel:r})),[{[o]:r},[]]},deserialize:n=>t.wrap(w({socket:e,messageChannel:Reflect.get(n,o)}))}))(e)),e.on("disconnect",(()=>{h.has(e)&&h.delete(e)}))),t.transferHandlers.set("proxy",h.get(e))};function w(e){const t=new WeakMap,{socket:r,messageChannel:o=n}=e;return f(r),{postMessage:(e,t)=>{r.emit(o,e)},addEventListener:(e,n)=>{if(e!==a)throw new Error(s);const i=e=>{"handleEvent"in n?n.handleEvent({data:e,ports:[]}):n({data:e,ports:[]})};r.on(o,i),t.set(n,i)},removeEventListener:(e,n)=>{if(e!==a)throw new Error(s);const i=t.get(n);i&&(r.off(o,i),t.delete(n))}}}const E=new Map,_=e=>{if(!E.has(e)){E.set(e,(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){const r=c();return t.expose(n,v({webSocket:e,messageChannel:r})),[{[o]:r},[]]},deserialize:n=>t.wrap(v({webSocket:e,messageChannel:Reflect.get(n,o)}))}))(e));const n=()=>{E.has(e)&&E.delete(e)};e.addEventListener("close",n)}t.transferHandlers.set("proxy",E.get(e))};function v(e){const{webSocket:t,messageChannel:r}=e,a=t,s=new WeakMap,o=r||n;return _(a),{postMessage:(e,t)=>{a.send(JSON.stringify({message:e,__channel__:o}))},addEventListener:(e,t)=>{const n=e=>{let n=null;try{n=JSON.parse(e.data)}catch{n=e.data}!n||!n.__channel__||!n.message||n.__channel__!==o||("handleEvent"in t?t.handleEvent({data:n.message}):t({data:n.message}))};a.addEventListener("message",n),s.set(t,n)},removeEventListener:(e,t)=>{const n=s.get(t);n&&(a.removeEventListener("message",n),s.delete(t))},start:()=>{}}}const M=new Map,b=e=>{if(!M.has(e)){M.set(e,(e=>({canHandle:e=>i(e)&&e[t.proxyMarker],serialize(n){const r=c();return t.expose(n,k({nodeProcess:e,messageChannel:r})),[{[o]:r},[]]},deserialize:n=>t.wrap(k({nodeProcess:e,messageChannel:Reflect.get(n,o)}))}))(e));const n=()=>{M.has(e)&&M.delete(e)};process.on("exit",n),process.on("disconnect",n),process.on("SIGINT",n),process.on("uncaughtException",n)}t.transferHandlers.set("proxy",M.get(e))};function k(e){const{nodeProcess:t,messageChannel:r}=e,a=new WeakMap,s=r||n;return b(t),{postMessage:(e,n)=>{t.send&&t.send({message:e,__channel__:s})},addEventListener:(e,n)=>{const r=e=>{if(!e||!e.__channel__||!e.message||e.__channel__!==s)return;const{message:t}=e;"handleEvent"in n?n.handleEvent({data:t}):n({data:t})};t.on("message",r),a.set(n,r)},removeEventListener:(e,n)=>{const r=a.get(n);r&&(t.off("message",r),a.delete(n))},start:()=>{}}}e.MESSAGE_CHANNEL_NAME=n,e.MESSAGE_EVENT_ERROR=s,e.MESSAGE_EVENT_NAME=a,e.MESSAGE_PORT_MARKER=r,e.PROXY_MESSAGE_CHANNEL_MARKER=o,e.chromeRuntimeMessageEndpoint=function(e){const{tabId:n=0,extensionId:r=""}=e||{};t.transferHandlers.set("proxy",m);const o=new Set,i=(e,t,n)=>{if(e&&o.size)for(const t of o.values())"handleEvent"in t?t.handleEvent({data:e,ports:[]}):t({data:e,ports:[]})};return r?chrome.runtime.onMessageExternal.addListener(i):chrome.runtime.onMessage.addListener(i),{start:()=>{},postMessage:(e,t)=>{n?chrome.tabs.sendMessage(n,e):r?chrome.runtime.sendMessage(r,e):chrome.runtime.sendMessage(e)},addEventListener:(e,t)=>{if(e!==a)throw new Error(s);o.add(t)},removeEventListener:(e,t)=>{if(e!==a)throw new Error(s);o.has(t)&&o.delete(t)}}},e.chromeRuntimePortEndpoint=function(e){t.transferHandlers.set("proxy",m);const n=new WeakMap;return{start:()=>{},postMessage:(t,n)=>{e.postMessage(t)},addEventListener:(t,r)=>{if(t!==a)throw new Error(s);const o=(e,t)=>{"handleEvent"in r?r.handleEvent({data:e,ports:[]}):r({data:e,ports:[]})};e.onMessage.addListener(o),n.set(r,o)},removeEventListener:(e,t)=>{if(e!==a)throw new Error(s);n.get(t)&&n.delete(t)}}},e.electronMainEndpoint=function(e){const{sender:t,ipcMain:r,messageChannelConstructor:o,channelName:i=n}=e;d(o);const c=new WeakMap;return{postMessage:(e,n)=>{t.postMessage(i,e,n)},addEventListener:(e,t)=>{if(e!==a)throw new Error(s);const n=(e,...n)=>{const{ports:r}=e,a=l(n[0],r);"handleEvent"in t?t.handleEvent({data:a,ports:r}):t({data:a,ports:r})};r.on(i,n),c.set(t,n)},removeEventListener:(e,t)=>{if(e!==a)throw new Error(s);const n=c.get(t);n&&(r.removeListener(i,n),c.delete(t))}}},e.electronMessagePortMainEndpoint=g,e.electronRendererEndpoint=function(e){d();const t=new WeakMap,{ipcRenderer:r,channelName:o=n}=e;return{postMessage:(e,t)=>{r.postMessage(o,e,t)},addEventListener:(e,n)=>{if(e!==a)throw new Error(s);const i=(e,...t)=>{const{ports:r}=e,a=l(t[0],r);"handleEvent"in n?n.handleEvent({data:a,ports:r}):n({data:a,ports:r})};r.on(o,i),t.set(n,i)},removeEventListener:(e,n)=>{if(e!==a)throw new Error(s);const i=t.get(n);i&&(r.removeListener(o,i),t.delete(n))}}},e.figmaCoreEndpoint=function(e){t.transferHandlers.set("proxy",y);const n=new WeakMap;return{postMessage:(t,n)=>{figma.ui.postMessage(t,{origin:(null==e?void 0:e.origin)||"*"})},addEventListener:(t,r)=>{if(t!==a)throw new Error(s);const o=async(t,n)=>{(null==e||!e.checkProps||await(null==e?void 0:e.checkProps(n)))&&("handleEvent"in r?r.handleEvent({data:t,ports:[]}):r({data:t,ports:[]}))};figma.ui.on(a,o),n.set(r,o)},removeEventListener:(e,t)=>{if(e!==a)throw new Error(s);const r=n.get(t);r&&(figma.ui.off(a,r),n.delete(t))}}},e.figmaUIEndpoint=function(e){t.transferHandlers.set("proxy",y);const n=new WeakMap;return{postMessage:(t,n)=>{globalThis.parent.postMessage({pluginMessage:t},{targetOrigin:(null==e?void 0:e.origin)||"*",transfer:n})},addEventListener:(e,t)=>{if(e!==a)throw new Error(s);const r=e=>{const{ports:n,data:r}=e;"handleEvent"in t?t.handleEvent({data:r.pluginMessage,ports:n}):t({data:r.pluginMessage,ports:n})};globalThis.addEventListener(a,r),n.set(t,r)},removeEventListener:(e,t)=>{if(e!==a)throw new Error(s);const r=n.get(t);r&&(globalThis.removeEventListener(a,r),n.delete(t))}}},e.nodeProcessEndpoint=k,e.socketIoEndpoint=w,e.webSocketEndpoint=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}(t,n(590))},590:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createEndpoint:()=>a,expose:()=>p,finalizer:()=>o,proxy:()=>v,proxyMarker:()=>r,releaseProxy:()=>s,transfer:()=>_,transferHandlers:()=>l,windowEndpoint:()=>M,wrap:()=>u});const r=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),s=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.finalizer"),i=Symbol("Comlink.thrown"),c=e=>"object"==typeof e&&null!==e||"function"==typeof e,l=new Map([["proxy",{canHandle:e=>c(e)&&e[r],serialize(e){const{port1:t,port2:n}=new MessageChannel;return p(e,t),[n,[n]]},deserialize:e=>(e.start(),u(e))}],["throw",{canHandle:e=>c(e)&&i in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function p(e,t=globalThis,n=["*"]){t.addEventListener("message",(function r(a){if(!a||!a.data)return;if(!function(e,t){for(const n of e){if(t===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,a.origin))return void console.warn(`Invalid origin '${a.origin}' for comlink proxy`);const{id:s,type:c,path:l}=Object.assign({path:[]},a.data),u=(a.data.argumentList||[]).map(k);let g;try{const t=l.slice(0,-1).reduce(((e,t)=>e[t]),e),n=l.reduce(((e,t)=>e[t]),e);switch(c){case"GET":g=n;break;case"SET":t[l.slice(-1)[0]]=k(a.data.value),g=!0;break;case"APPLY":g=n.apply(t,u);break;case"CONSTRUCT":g=v(new n(...u));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;p(e,n),g=_(t,[t])}break;case"RELEASE":g=void 0;break;default:return}}catch(e){g={value:e,[i]:0}}Promise.resolve(g).catch((e=>({value:e,[i]:0}))).then((n=>{const[a,i]=b(n);t.postMessage(Object.assign(Object.assign({},a),{id:s}),i),"RELEASE"===c&&(t.removeEventListener("message",r),d(t),o in e&&"function"==typeof e[o]&&e[o]())})).catch((e=>{const[n,r]=b({value:new TypeError("Unserializable return value"),[i]:0});t.postMessage(Object.assign(Object.assign({},n),{id:s}),r)}))})),t.start&&t.start()}function d(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function u(e,t){const n=new Map;return e.addEventListener("message",(function(e){const{data:t}=e;if(!t||!t.id)return;const r=n.get(t.id);if(r)try{r(t)}finally{n.delete(t.id)}})),f(e,n,[],t)}function g(e){if(e)throw new Error("Proxy has been released and is not useable")}function y(e){return L(e,new Map,{type:"RELEASE"}).then((()=>{d(e)}))}const m=new WeakMap,h="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(m.get(e)||0)-1;m.set(e,t),0===t&&y(e)}));function f(e,t,n=[],r=function(){}){let o=!1;const i=new Proxy(r,{get(r,a){if(g(o),a===s)return()=>{!function(e){h&&h.unregister(e)}(i),y(e),t.clear(),o=!0};if("then"===a){if(0===n.length)return{then:()=>i};const r=L(e,t,{type:"GET",path:n.map((e=>e.toString()))}).then(k);return r.then.bind(r)}return f(e,t,[...n,a])},set(r,a,s){g(o);const[i,c]=b(s);return L(e,t,{type:"SET",path:[...n,a].map((e=>e.toString())),value:i},c).then(k)},apply(r,s,i){g(o);const c=n[n.length-1];if(c===a)return L(e,t,{type:"ENDPOINT"}).then(k);if("bind"===c)return f(e,t,n.slice(0,-1));const[l,p]=w(i);return L(e,t,{type:"APPLY",path:n.map((e=>e.toString())),argumentList:l},p).then(k)},construct(r,a){g(o);const[s,i]=w(a);return L(e,t,{type:"CONSTRUCT",path:n.map((e=>e.toString())),argumentList:s},i).then(k)}});return function(e,t){const n=(m.get(t)||0)+1;m.set(t,n),h&&h.register(e,t,e)}(i,e),i}function w(e){const t=e.map(b);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const E=new WeakMap;function _(e,t){return E.set(e,t),e}function v(e){return Object.assign(e,{[r]:!0})}function M(e,t=globalThis,n="*"){return{postMessage:(t,r)=>e.postMessage(t,n,r),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function b(e){for(const[t,n]of l)if(n.canHandle(e)){const[r,a]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},a]}return[{type:"RAW",value:e},E.get(e)||[]]}function k(e){switch(e.type){case"HANDLER":return l.get(e.name).deserialize(e.value);case"RAW":return e.value}}function L(e,t,n,r){return new Promise((a=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.set(s,a),e.start&&e.start(),e.postMessage(Object.assign({id:s},n),r)}))}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};const Comlink=__webpack_require__(590),{chromeRuntimeMessageEndpoint}=__webpack_require__(484);console.log("[dicepass] Hello from dicepass background");let encryptionKey=null;async function deriveEncryptionKey(e){const t=(new TextEncoder).encode(e);let{salt:n}=await chrome.storage.local.get(["salt"]);n?n=new Uint8Array(n):(n=crypto.getRandomValues(new Uint8Array(16)),chrome.storage.local.set({salt:Array.from(n)}));const r=await crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function encrypt(e,t){const n=(new TextEncoder).encode(t),r=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},e,n);return Array.from(r).map((e=>e.toString(16).padStart(2,"0"))).join("")+"|"+Array.from(new Uint8Array(a)).map((e=>e.toString(16).padStart(2,"0"))).join("")}async function decrypt(e,t){const[n,r]=t.split("|"),a=new Uint8Array(n.match(/.{1,2}/g).map((e=>parseInt(e,16)))),s=new Uint8Array(r.match(/.{1,2}/g).map((e=>parseInt(e,16)))),o=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},e,s);return(new TextDecoder).decode(o)}const contentContext={async getLogin(e){const{origins:t={}}=await chrome.storage.session.get("origins"),n=t[e];if(!n||!encryptionKey)return null;const{vault:r=[]}=await chrome.storage.local.get("vault");for(const e of r)if(await decrypt(encryptionKey,e.origin)===n)return{username:await decrypt(encryptionKey,e.username),password:await decrypt(encryptionKey,e.password)};return null},async hasPasswordFor(e){const{origins:t={}}=await chrome.storage.session.get("origins"),n=t[e];if(!n)return!1;const{vault:r=[]}=await chrome.storage.local.get("vault");for(const e of r)if(await decrypt(encryptionKey,e.origin)===n)return!0;return!1},async add(e,t,n){const{origins:r={}}=await chrome.storage.session.get("origins"),a=r[e];if(!a||!encryptionKey)return;const{vault:s=[]}=await chrome.storage.local.get("vault");s.push({origin:await encrypt(encryptionKey,a),username:await encrypt(encryptionKey,t),password:await encrypt(encryptionKey,n)}),chrome.storage.local.set({vault:s})},isLoggedIn:()=>Boolean(encryptionKey)},popupContext={async initialized(){const{initialized:e}=await chrome.storage.local.get("initialized");return Boolean(e)},async initialize(e){return!(await this.initialized()||encryptionKey||!e||(encryptionKey=await deriveEncryptionKey(e),chrome.storage.local.set({initialized:await encrypt(encryptionKey,"initialized")}),await popupContext.add("https://dicepass.dicec.tf","test_user","test_password"),0))},isLoggedIn:async()=>Boolean(encryptionKey),async login(e){const{initialized:t}=await chrome.storage.local.get("initialized");if(!t||!e)return!1;const n=await deriveEncryptionKey(e);try{return"initialized"===await decrypt(n,t)&&(encryptionKey=n,!0)}catch{return!1}},async logout(){chrome.storage.session.clear(),encryptionKey=null},async clear(){chrome.storage.local.clear(),chrome.storage.session.clear(),encryptionKey=null},async vault(){const{vault:e=[]}=await chrome.storage.local.get("vault"),t=[];for(const n of e){const e=await decrypt(encryptionKey,n.origin),r=await decrypt(encryptionKey,n.username);t.push({origin:e,username:r})}return t},async reveal(e,t){if(!await this.login(t))return{error:"Invalid master password"};const{vault:n=[]}=await chrome.storage.local.get("vault"),r=await deriveEncryptionKey(t);for(const t of n)if(await decrypt(r,t.origin)===e)return{error:!1,password:await decrypt(r,t.password)};return{error:"No password found for origin"}},async add(e,t,n){const{vault:r=[]}=await chrome.storage.local.get("vault");r.push({origin:await encrypt(encryptionKey,e),username:await encrypt(encryptionKey,t),password:await encrypt(encryptionKey,n)}),chrome.storage.local.set({vault:r})},async remove(e){const{vault:t=[]}=await chrome.storage.local.get("vault");for(let n=0;n<t.length;n++)if(await decrypt(encryptionKey,t[n].origin)===e){t.splice(n,1);break}chrome.storage.local.set({vault:t})}};chrome.runtime.onMessage.addListener(((e,t,n)=>{if("init-popup"===e&&t.url==="chrome-extension://"+chrome.runtime.id+"/popup.html")Comlink.expose(popupContext,chromeRuntimeMessageEndpoint()),n("ok");else if("init-content"===e&&t.origin&&t.tab&&t.tab.id){Comlink.expose(contentContext,chromeRuntimeMessageEndpoint({tabId:t.tab.id}));const{origins:e={}}=chrome.storage.session.get("origins");e[t.tab.id]=t.origin,chrome.storage.session.set({origins:e}),n(t.tab.id)}return!0}));